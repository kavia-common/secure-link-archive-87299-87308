{"is_source_file": true, "format": "Python", "description": "This file contains service functions for URL archiving, content fetching, normalization, short code generation, and record management within a URL shortener and archive project.", "external_files": ["httpx", "bs4", "os", "json", "re", "secrets", "datetime", "pathlib"], "external_methods": ["httpx.Client", "BeautifulSoup", "os.getenv", "os.path.exists", "os.makedirs", "Path.resolve", "Path.mkdir", "Path.open"], "published": ["archive_url", "get_record_by_code", "get_record_by_id", "get_archived_content", "compare_current_vs_archived", "get_base_url"], "classes": [], "methods": [{"name": "datetime _now_utc()", "description": "Returns the current UTC time with timezone info.", "scope": "", "scopeKind": ""}, {"name": "str get_base_url()", "description": "Derives the base URL for generated short URLs from environment variables or defaults to localhost.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] _load_index()", "description": "Loads the index JSON data from disk, initializing default if missing.", "scope": "", "scopeKind": ""}, {"name": "None _save_index(data: Dict[str, Any])", "description": "Persists the index data to disk.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,str] _safe_fetch(url: str, timeout: float = 10.0)", "description": "Fetches URL content safely, enforcing URL schemes, host restrictions, and size limits. Returns content and content type.", "scope": "", "scopeKind": ""}, {"name": "str _normalize_html(html: str)", "description": "Removes scripts/styles from HTML and normalizes whitespace for diffing.", "scope": "", "scopeKind": ""}, {"name": "str _generate_code(url: str)", "description": "Generates a short code from the URL using hash and a random salt.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] archive_url(url: str, note: Optional[str] = None)", "description": "Archives the content of a URL and creates a short code record.", "scope": "", "scopeKind": ""}, {"name": "Optional[Dict[str,Any]] get_record_by_code(code: str)", "description": "Retrieves an archive record by its short code.", "scope": "", "scopeKind": ""}, {"name": "Optional[Dict[str,Any]] get_record_by_id(_id: str)", "description": "Retrieves an archive record by its ID.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] get_archived_content(code: str)", "description": "Loads the archived normalized content for a given code.", "scope": "", "scopeKind": ""}, {"name": "Tuple[bool,Dict[str,int],Dict[str,Any]] compare_current_vs_archived(code: str)", "description": "Compares current fetched content with archived version, returning change info.", "scope": "", "scopeKind": ""}, {"name": "str _inject_header(content: str, code: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "compare(code: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "create_short_link(payload: ShortenRequest)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "header_script()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "header_style()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "redirect_with_header(code: str)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["httpx.Client", "BeautifulSoup", "os.getenv", "os.path.exists", "Path.resolve", "Path.open", "json.load", "json.dump", "hashlib.sha256", "hashlib.md5", "secrets.token_urlsafe", "datetime.now", "Path.mkdir", "Path.read_text", "Path.write_text"], "search-terms": ["archive_url", "short code generation", "content normalization", "URL fetch safety", "HTML cleanup", "index management", "URL record lookup", "content comparison"], "state": 2, "file_id": 9, "knowledge_revision": 21, "git_revision": "", "ctags": [{"_type": "tag", "name": "ARCHIVE_DIR", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^ARCHIVE_DIR = DATA_DIR \\/ \"archives\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DATA_DIR", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^DATA_DIR = Path(__file__).resolve().parent.parent \\/ \"data\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "INDEX_FILE", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^INDEX_FILE = DATA_DIR \\/ \"index.json\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_generate_code", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _generate_code(url: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(url: str)"}, {"_type": "tag", "name": "_inject_header", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _inject_header(content: str, code: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(content: str, code: str)"}, {"_type": "tag", "name": "_load_index", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _load_index() -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_normalize_html", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _normalize_html(html: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(html: str)"}, {"_type": "tag", "name": "_now_utc", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _now_utc() -> datetime:$/", "language": "Python", "typeref": "typename:datetime", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_safe_fetch", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _safe_fetch(url: str, timeout: float = 10.0) -> Tuple[str, str]:$/", "language": "Python", "typeref": "typename:Tuple[str,str]", "kind": "function", "signature": "(url: str, timeout: float = 10.0)"}, {"_type": "tag", "name": "_save_index", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _save_index(data: Dict[str, Any]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(data: Dict[str, Any])"}, {"_type": "tag", "name": "archive_url", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def archive_url(url: str, note: Optional[str] = None) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(url: str, note: Optional[str] = None)"}, {"_type": "tag", "name": "compare", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def compare(code: str):$/", "language": "Python", "kind": "function", "signature": "(code: str)"}, {"_type": "tag", "name": "compare_current_vs_archived", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def compare_current_vs_archived(code: str) -> Tuple[bool, Dict[str, int], Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Tuple[bool,Dict[str,int],Dict[str,Any]]", "kind": "function", "signature": "(code: str)"}, {"_type": "tag", "name": "create_short_link", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def create_short_link(payload: ShortenRequest):$/", "language": "Python", "kind": "function", "signature": "(payload: ShortenRequest)"}, {"_type": "tag", "name": "get_archived_content", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def get_archived_content(code: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(code: str)"}, {"_type": "tag", "name": "get_base_url", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def get_base_url() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_record_by_code", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def get_record_by_code(code: str) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "function", "signature": "(code: str)"}, {"_type": "tag", "name": "get_record_by_id", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def get_record_by_id(_id: str) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "function", "signature": "(_id: str)"}, {"_type": "tag", "name": "header_script", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def header_script():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "header_style", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def header_style():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "redirect_with_header", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def redirect_with_header(code: str):$/", "language": "Python", "kind": "function", "signature": "(code: str)"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^router = APIRouter(prefix=\"\\/api\\/compare\", tags=[\"compare\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^router = APIRouter(prefix=\"\\/api\\/header\", tags=[\"header\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^router = APIRouter(prefix=\"\\/api\\/urls\", tags=[\"shorten\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^router = APIRouter(prefix=\"\\/r\", tags=[\"redirect\"])$/", "language": "Python", "kind": "variable"}], "hash": "c7924d45728b645a53539b95fe31dbda", "format-version": 4, "code-base-name": "link_shortener_backend", "filename": "link_shortener_backend/src/api/services.py", "fields": [{"name": "ARCHIVE_DIR = DATA_DIR \\/ \"archives\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DATA_DIR = Path(__file__).resolve().parent.parent \\/ \"data\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "INDEX_FILE = DATA_DIR \\/ \"index.json\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/api\\/compare\", tags=[\"compare\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/api\\/header\", tags=[\"header\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/api\\/urls\", tags=[\"shorten\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/r\", tags=[\"redirect\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"21": ""}]}