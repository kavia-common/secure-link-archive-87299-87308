{"is_source_file": true, "format": "Python", "description": "This file provides a set of utility functions and an API for URL archiving, content fetching, normalization, and comparison, primarily aimed at creating and managing short URL archives with content normalization and storage.", "external_files": ["httpx", "bs4", "os", "re", "secrets", "json", "hashlib", "datetime", "pathlib"], "external_methods": ["httpx.Client", "BeautifulSoup"], "published": ["get_base_url", "archive_url", "get_record_by_code", "get_record_by_id", "get_archived_content", "compare_current_vs_archived"], "classes": [], "methods": [{"name": "datetime _now_utc()", "description": "Returns the current UTC datetime with timezone information.", "scope": "", "scopeKind": ""}, {"name": "str get_base_url()", "description": "Derives the base URL for short URLs from environment variable or defaults.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] _load_index()", "description": "Loads the URL archive index from JSON file.", "scope": "", "scopeKind": ""}, {"name": "None _save_index(data: Dict[str, Any])", "description": "Saves the URL archive index to the JSON file.", "scope": "", "scopeKind": ""}, {"name": "Tuple[str,str] _safe_fetch(url: str, timeout: float = 10.0)", "description": "Fetches URL content with safety restrictions such as allowed protocols, size limit, and redirect handling.", "scope": "", "scopeKind": ""}, {"name": "str _normalize_html(html: str)", "description": "Removes scripts, styles, and normalizes whitespace in HTML content for diffing.", "scope": "", "scopeKind": ""}, {"name": "str _generate_code(url: str)", "description": "Generates a short code hash based on URL and a random salt.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] archive_url(url: str, note: Optional[str] = None)", "description": "Archives the content of a URL and creates a short code entry, storing normalized content.", "scope": "", "scopeKind": ""}, {"name": "Optional[Dict[str,Any]] get_record_by_code(code: str)", "description": "Retrieves an archive record by its short code.", "scope": "", "scopeKind": ""}, {"name": "Optional[Dict[str,Any]] get_record_by_id(_id: str)", "description": "Retrieves an archive record by its unique ID.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] get_archived_content(code: str)", "description": "Loads the archived normalized content for a given short code.", "scope": "", "scopeKind": ""}, {"name": "Tuple[bool,Dict[str,int],Dict[str,Any]] compare_current_vs_archived(code: str)", "description": "Compares the current fetched content with its archived version, reporting differences.", "scope": "", "scopeKind": ""}], "calls": ["os.getenv", "Path.resolve", "Path.exists", "Path.open", "datetime.now", "json.load", "json.dump", "re.match", "re.search", "httpx.Client", "client.get", "resp.raise_for_status", "resp.headers.get", "resp.text", "BeautifulSoup", "hashlib.sha256", "secrets.token_urlsafe", "hashlib.md5", "Path.read_text", "Path.mkdir"], "search-terms": ["archive_url", "short code generation", "content normalization", "URL fetching restrictions", "content comparison", "URL archive index", "HTML cleaning", "deduplication"], "state": 2, "file_id": 9, "knowledge_revision": 25, "git_revision": "466527cbeaa90b4a6cf7e6bf06c3f8fce9c5cd42", "revision_history": [{"21": ""}, {"23": "466527cbeaa90b4a6cf7e6bf06c3f8fce9c5cd42"}, {"25": "466527cbeaa90b4a6cf7e6bf06c3f8fce9c5cd42"}], "ctags": [{"_type": "tag", "name": "ARCHIVE_DIR", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^ARCHIVE_DIR = DATA_DIR \\/ \"archives\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DATA_DIR", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^DATA_DIR = Path(__file__).resolve().parent.parent \\/ \"data\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "INDEX_FILE", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^INDEX_FILE = DATA_DIR \\/ \"index.json\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_generate_code", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _generate_code(url: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(url: str)"}, {"_type": "tag", "name": "_load_index", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _load_index() -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_normalize_html", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _normalize_html(html: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(html: str)"}, {"_type": "tag", "name": "_now_utc", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _now_utc() -> datetime:$/", "language": "Python", "typeref": "typename:datetime", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_safe_fetch", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _safe_fetch(url: str, timeout: float = 10.0) -> Tuple[str, str]:$/", "language": "Python", "typeref": "typename:Tuple[str,str]", "kind": "function", "signature": "(url: str, timeout: float = 10.0)"}, {"_type": "tag", "name": "_save_index", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def _save_index(data: Dict[str, Any]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(data: Dict[str, Any])"}, {"_type": "tag", "name": "archive_url", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def archive_url(url: str, note: Optional[str] = None) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(url: str, note: Optional[str] = None)"}, {"_type": "tag", "name": "compare_current_vs_archived", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def compare_current_vs_archived(code: str) -> Tuple[bool, Dict[str, int], Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Tuple[bool,Dict[str,int],Dict[str,Any]]", "kind": "function", "signature": "(code: str)"}, {"_type": "tag", "name": "get_archived_content", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def get_archived_content(code: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(code: str)"}, {"_type": "tag", "name": "get_base_url", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def get_base_url() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_record_by_code", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def get_record_by_code(code: str) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "function", "signature": "(code: str)"}, {"_type": "tag", "name": "get_record_by_id", "path": "/home/kavia/workspace/code-generation/secure-link-archive-87299-87308/link_shortener_backend/src/api/services.py", "pattern": "/^def get_record_by_id(_id: str) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "function", "signature": "(_id: str)"}], "hash": "dde4eb85b596f8d57411ca7f2dcc0154", "format-version": 4, "code-base-name": "link_shortener_backend", "filename": "link_shortener_backend/src/api/services.py", "fields": [{"name": "ARCHIVE_DIR = DATA_DIR \\/ \"archives\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DATA_DIR = Path(__file__).resolve().parent.parent \\/ \"data\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "INDEX_FILE = DATA_DIR \\/ \"index.json\"", "scope": "", "scopeKind": "", "description": "unavailable"}]}